function i(e){nl.html(""),np=[];var o,n=[],a=new google.maps.LatLngBounds(new google.maps.LatLng(parseFloat(objValues.south_bound),parseFloat(objValues.west_bound)),new google.maps.LatLng(parseFloat(objValues.north_bound),parseFloat(objValues.east_bound)));null===e?o=a.getCenter():(o=e,a=new google.maps.LatLngBounds(o),z=Math.round(14-Math.log(parseInt(document.getElementById("radius-level").value))/Math.LN2)),mm=new google.maps.Map(document.getElementById("map-canvas"),{center:o,zoom:z});var t=new google.maps.Geocoder;t.geocode({latLng:o},function(e,a){if(a==google.maps.GeocoderStatus.OK){var t=new google.maps.Marker({map:mm,title:e[0].address_components[2].long_name,position:o,icon:objValues.default_marker_url});mc(t,e[0].formatted_address),n.push(t)}});var s=(new google.maps.places.PlacesService(mm),new google.maps.places.Autocomplete(ai),new google.maps.places.SearchBox(ai));google.maps.event.addListenerOnce(s,"places_changed",function(){cp=s.getPlaces(),fnb()}),lr=google.maps.event.addListener(mm,"bounds_changed",function(){var e=mm.getBounds();mm.getZoom()>19&&(mm.setZoom(19),google.maps.event.removeListener(lr)),s.setBounds(e)})}function fnb(){var e=cp;if(e.length>0){if(!e[0].geometry)return;e[0].geometry.viewport?mm.fitBounds(e[0].geometry.viewport):(mm.setCenter(e[0].geometry.location),mm.setZoom(17));var o=(new google.maps.LatLngBounds,{location:e[0].geometry.location,radius:1e3*parseInt(document.getElementById("radius-level").value),types:["train_station"]}),n=new google.maps.places.PlacesService(mm);n.nearbySearch(o,cb),i(e[0].geometry.location)}}function mp(e,o){for(var n,a=[],t=0;n=a[t];t++)n.setMap(null);var n=new google.maps.Marker({map:mm,title:e.name,position:e.geometry.location,icon:objValues.place_marker_url}),s=new google.maps.Geocoder;s.geocode({location:e.geometry.location},function(o,a){a==google.maps.GeocoderStatus.OK&&o[1]?mc(n,o[1].formatted_address):mc(n,e.name)}),a.push(n),null!==o&&o.extend(e.geometry.location)}function cb(e,o,n){if(jQuery("#gs-nearby-results").fadeOut(),jQuery("#gs-nearby-results").html(""),o===google.maps.places.PlacesServiceStatus.OK){jQuery("#gs-nearby-results").append("<h3>Nearby Search</h3>");for(var a=0;a<e.length;a++)if(np.indexOf(e[a].name)<0){var t=jQuery("<li></li>");np.push(e[a].name),t.attr("class","address_list"),t.append("<p>"+e[a].name+"</p>"),nl.append(t),mp(e[a],null)}jQuery("#gs-nearby-results").append(nl),jQuery("#gs-nearby-results").append('<a id="more" href="javascript:void(0);">More</a>'),jQuery("#gs-nearby-results").fadeIn();var s=document.getElementById("more");n.hasNextPage?(jQuery("#more").show(),s.disabled=!1,google.maps.event.addDomListenerOnce(s,"click",function(){s.disabled=!0,n.nextPage()})):jQuery("#more").hide()}else jQuery("#gs-nearby-results").append("<h3>No result found</h3>"),jQuery("#gs-nearby-results").fadeIn()}function mc(e,o){var n=new google.maps.InfoWindow({content:o,maxWidth:150});google.maps.event.addListener(e,"click",function(){mm.setZoom(19),n.open(mm,e),mm.setCenter(e.getPosition())}),google.maps.event.addListener(n,"closeclick",function(){mm.panTo(e.getPosition()),mm.setZoom(z)})}var mm,z=11,ai=document.getElementById("autocomplete"),cp=[],np=[],nl=jQuery("<ul></ul>");nl.attr("id","gs-nearby-list"),nl.addClass("gs-full-width"),"undefined"==typeof jQuery&&document.write('<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>'),jQuery(window).load(function(){jQuery("#radius-level").chosen(),i(null)}),document.getElementById("searchbutton").onclick=function(){if(google.maps.event.trigger(ai,"focus"),google.maps.event.trigger(ai,"keydown",{keyCode:13}),cp.length<1){var e=new google.maps.Geocoder;e.geocode({address:'"'+ai.value+'"'},function(e,o){"OK"==o&&(cp=e,fnb())})}};